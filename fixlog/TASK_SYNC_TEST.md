# 任务同步测试指南

## 测试目的
验证 task-panel 和 task-manager 之间的数据同步是否正常工作。

## 测试场景

### 场景1：从 task-panel 添加任务
1. 打开应用，确保悬浮图标可见
2. 点击悬浮图标打开 task-panel
3. 在 task-panel 中添加一个新任务，例如："测试任务1"
4. 打开 task-manager 窗口（通过托盘菜单或其他方式）
5. **预期结果**：新任务应该立即在 task-manager 中显示

### 场景2：从 task-manager 添加任务
1. 打开 task-manager 窗口
2. 添加一个新任务，例如："测试任务2"
3. 打开 task-panel
4. **预期结果**：新任务应该在 task-panel 中显示

### 场景3：完成任务同步
1. 在 task-panel 中完成一个任务
2. 切换到 task-manager 的"已完成"分类
3. **预期结果**：已完成的任务应该出现在已完成列表中

### 场景4：编辑任务同步
1. 在 task-manager 中编辑一个任务的内容
2. 切换到 task-panel
3. **预期结果**：任务内容的修改应该在 task-panel 中反映

### 场景5：设置提醒同步
1. 在 task-panel 中为任务设置提醒时间
2. 切换到 task-manager
3. **预期结果**：提醒时间应该在 task-manager 中显示

### 场景6：窗口焦点刷新
1. 在 task-panel 中添加任务
2. 不关闭 task-manager，直接点击 task-manager 窗口使其获得焦点
3. **预期结果**：新任务应该立即显示（无需手动刷新）

### 场景7：手动刷新
1. 在 task-manager 中按 F5 或 Ctrl+R
2. **预期结果**：数据应该刷新，控制台应该显示刷新日志

## 调试信息
在测试过程中，注意观察控制台输出：
- `主进程: 已向所有窗口广播任务更新` - 表示主进程正在广播更新
- `TaskApplicationService: 加载未完成任务 X 个` - 表示应用服务正在加载数据
- `Task Manager: 数据已刷新` - 表示 task-manager 正在刷新数据

## 故障排除

### 如果任务不同步：
1. 检查控制台是否有错误信息
2. 确认主进程是否发送了广播更新
3. 确认 task-application-service 是否接收到了 IPC 事件
4. 尝试手动刷新（F5 或 Ctrl+R）

### 如果窗口焦点刷新不工作：
1. 确认窗口确实获得了焦点
2. 检查 `refreshData` 方法是否被调用
3. 查看控制台的刷新日志

## 性能考虑
- 广播更新只在任务操作后触发，不会造成性能问题
- 窗口焦点刷新有防抖机制，避免频繁刷新
- 本地缓存减少了不必要的 IPC 调用

## 成功标准
所有测试场景都应该按预期工作，数据在两个窗口之间实时同步，无需手动刷新或重启应用。