name: Build on Tag
on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write  # å…è®¸åˆ›å»º Release å’Œä¸Šä¼ æ–‡ä»¶

jobs:
  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - name: Setup Python (macOS)
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - run: npm install
      - run: npm run build:mac
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          CSC_IDENTITY_AUTO_DISCOVERY: false
          PYTHON_PATH: /usr/bin/python3
          npm_config_python: /usr/bin/python3
      - name: List build artifacts
        run: ls -la dist/
      - uses: actions/upload-artifact@v4
        with:
          name: macos-dmg
          path: dist/*.dmg

  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
      - run: npm install
      - run: npm run build:win
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - uses: actions/upload-artifact@v4
        with:
          name: windows-exe
          path: dist/*.exe

  release:
    needs: [build-macos, build-windows]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: macos-dmg
          path: dist/
      - uses: actions/download-artifact@v4
        with:
          name: windows-exe
          path: dist/
      - name: List all artifacts
        run: ls -la dist/
      - name: Extract version from tag
        id: get_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
      - name: Generate release notes
        run: |
          cat > RELEASE_NOTES.md << 'EOF'
          # MoliTodo v${{ steps.get_version.outputs.VERSION }} ï¿½
          
          ## âœ¨ çœ‹æ¿è§†å›¾åŠŸèƒ½é‡ç£…å‘å¸ƒ
          
          ### ï¿½ å…¨èƒ½æ–°çœ‹æ¿ç®¡ç†ç³»ç»Ÿ (Kanban Board System)
          - **å¯è§†åŒ–ä»»åŠ¡æµç¨‹**: å…¨æ–°çš„å››åˆ—çœ‹æ¿å¸ƒå±€ï¼ˆå¾…åŠžã€è¿›è¡Œä¸­ã€æš‚åœä¸­ã€å·²å®Œæˆï¼‰ï¼Œç›´è§‚å±•ç¤ºä»»åŠ¡æµè½¬è¿‡ç¨‹
          - **æ‹–æ‹½å¼çŠ¶æ€ç®¡ç†**: æ”¯æŒé€šè¿‡æ‹–æ‹½æ“ä½œå¿«é€Ÿæ”¹å˜ä»»åŠ¡çŠ¶æ€ï¼Œæ“ä½œæ›´åŠ ç›´è§‚é«˜æ•ˆ
          - **æ™ºèƒ½çŠ¶æ€è¿½è¸ª**: æ‹–æ‹½æ“ä½œè‡ªåŠ¨è§¦å‘ç›¸åº”çš„æ—¶é—´è¿½è¸ªåŠŸèƒ½ï¼ˆå¼€å§‹ã€æš‚åœã€å®Œæˆç­‰ï¼‰
          - **å®žæ—¶ä»»åŠ¡ç»Ÿè®¡**: æ¯åˆ—æ˜¾ç¤ºå®žæ—¶ä»»åŠ¡æ•°é‡ï¼Œå¿«é€Ÿäº†è§£å„çŠ¶æ€ä»»åŠ¡åˆ†å¸ƒ
          - **å“åº”å¼è®¾è®¡**: å®Œç¾Žé€‚é…æ¡Œé¢ã€å¹³æ¿å’Œç§»åŠ¨è®¾å¤‡ï¼Œç§»åŠ¨ç«¯æ”¯æŒæ¨ªå‘æ»šåŠ¨
          
          ### ðŸŽ¯ çœ‹æ¿æ ¸å¿ƒç»„ä»¶æž¶æž„
          - **KanbanBoard**: çœ‹æ¿ä¸»å®¹å™¨ï¼Œç®¡ç†å››åˆ—å¸ƒå±€å’Œæ‹–æ‹½ä¸Šä¸‹æ–‡
          - **KanbanColumn**: å•ä¸ªçœ‹æ¿åˆ—ï¼Œå¤„ç†ç‰¹å®šçŠ¶æ€ä»»åŠ¡æ˜¾ç¤ºå’Œæ‹–æ‹½æŽ¥æ”¶
          - **KanbanCard**: ä»»åŠ¡å¡ç‰‡ï¼Œæ˜¾ç¤ºå®Œæ•´ä»»åŠ¡ä¿¡æ¯å¹¶æ”¯æŒæ‹–æ‹½æ“ä½œ
          - **KanbanAddTask**: å¿«é€Ÿä»»åŠ¡æ·»åŠ ç»„ä»¶ï¼Œæ”¯æŒåœ¨æŒ‡å®šçŠ¶æ€åˆ—ç›´æŽ¥åˆ›å»ºä»»åŠ¡
          
          ## ðŸš€ ç”¨æˆ·ä½“éªŒé©æ–°
          
          ### ç›´è§‚çš„ä»»åŠ¡ç®¡ç†
          - **çŠ¶æ€å¯è§†åŒ–**: å››åˆ—å¸ƒå±€æ¸…æ™°å±•ç¤ºä»»åŠ¡åœ¨ä¸åŒé˜¶æ®µçš„åˆ†å¸ƒæƒ…å†µ
          - **æ‹–æ‹½æ“ä½œ**: é€šè¿‡ç®€å•çš„æ‹–æ‹½åŠ¨ä½œå³å¯æ”¹å˜ä»»åŠ¡çŠ¶æ€ï¼Œæ— éœ€ç‚¹å‡»å¤šä¸ªæŒ‰é’®
          - **å³æ—¶åé¦ˆ**: æ‹–æ‹½è¿‡ç¨‹ä¸­æä¾›è§†è§‰åé¦ˆï¼Œæ“ä½œç»“æžœç«‹å³å¯è§
          - **æ‰¹é‡ç®¡ç†**: å¯ä»¥å¿«é€Ÿæµè§ˆå’Œç®¡ç†å¤§é‡ä»»åŠ¡ï¼Œæå‡å·¥ä½œæ•ˆçŽ‡
          
          ### æ™ºèƒ½äº¤äº’è®¾è®¡
          - **å³é”®èœå•**: ä»»åŠ¡å¡ç‰‡æ”¯æŒå³é”®èœå•ï¼Œæä¾›ç¼–è¾‘å’Œåˆ é™¤ç­‰å¿«æ·æ“ä½œ
          - **ç©ºçŠ¶æ€å¼•å¯¼**: å„åˆ—æä¾›å‹å¥½çš„ç©ºçŠ¶æ€æç¤ºå’Œæ“ä½œæŒ‡å¯¼
          - **é”™è¯¯å¤„ç†**: æ‹–æ‹½å¤±è´¥æ—¶è‡ªåŠ¨æ¢å¤ï¼Œæä¾›å‹å¥½çš„é”™è¯¯æç¤º
          - **é”®ç›˜æ”¯æŒ**: æ”¯æŒé”®ç›˜å¯¼èˆªå’Œæ— éšœç¢è®¿é—®
          
          ## ðŸ”§ æŠ€æœ¯å®žçŽ°äº®ç‚¹
          
          ### æ‹–æ‹½ç³»ç»Ÿæž¶æž„
          - **HTML5 Drag API**: åŸºäºŽåŽŸç”Ÿ HTML5 æ‹–æ‹½ API å®žçŽ°ï¼Œæ€§èƒ½ä¼˜å¼‚
          - **çŠ¶æ€ç®¡ç†é›†æˆ**: ä¸ŽçŽ°æœ‰ TaskStore æ— ç¼é›†æˆï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§
          - **ä¹è§‚æ›´æ–°**: å…ˆæ›´æ–° UI åŽåŒæ­¥æ•°æ®ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ
          - **å†²çªå¤„ç†**: æ™ºèƒ½å¤„ç†å¹¶å‘æ“ä½œå’Œæ•°æ®å†²çª
          
          ### ç»„ä»¶åŒ–è®¾è®¡
          - **æ¨¡å—åŒ–æž¶æž„**: é‡‡ç”¨ç»„ä»¶åŒ–è®¾è®¡ï¼Œä¾¿äºŽç»´æŠ¤å’Œæ‰©å±•
          - **Props/Events é€šä¿¡**: æ ‡å‡†åŒ–çš„ç»„ä»¶é€šä¿¡æœºåˆ¶
          - **æ ·å¼ç³»ç»Ÿ**: å®Œå…¨åŸºäºŽ Tailwind CSSï¼Œæ”¯æŒä¸»é¢˜åˆ‡æ¢
          - **ç±»åž‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»åž‹å®šä¹‰
          
          ### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
          - **è™šæ‹Ÿæ»šåŠ¨**: å¤§é‡ä»»åŠ¡æ—¶çš„æ€§èƒ½ä¼˜åŒ–
          - **é˜²æŠ–å¤„ç†**: æ‹–æ‹½äº‹ä»¶çš„é˜²æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹æ“ä½œ
          - **æ‡’åŠ è½½**: éžå…³é”®ç»„ä»¶çš„å»¶è¿ŸåŠ è½½
          - **å†…å­˜ç®¡ç†**: åŠæ—¶æ¸…ç†äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
          
          ## ðŸŽ¨ è§†è§‰è®¾è®¡ç‰¹è‰²
          
          ### çŽ°ä»£åŒ–ç•Œé¢
          - **å¡ç‰‡å¼è®¾è®¡**: é‡‡ç”¨çŽ°ä»£åŒ–çš„å¡ç‰‡å¸ƒå±€ï¼Œä¿¡æ¯å±‚æ¬¡æ¸…æ™°
          - **ä¸»é¢˜é€‚é…**: å®Œç¾Žæ”¯æŒæ˜Žæš—ä¸»é¢˜åˆ‡æ¢ï¼Œä¿æŒè§†è§‰ä¸€è‡´æ€§
          - **åŠ¨ç”»æ•ˆæžœ**: æµç•…çš„æ‹–æ‹½åŠ¨ç”»å’ŒçŠ¶æ€è½¬æ¢æ•ˆæžœ
          - **å›¾æ ‡ç³»ç»Ÿ**: ä½¿ç”¨ Font Awesome å›¾æ ‡ï¼Œæå‡è§†è§‰è¯†åˆ«åº¦
          
          ### ä¿¡æ¯å±•ç¤ºä¼˜åŒ–
          - **ä»»åŠ¡è¯¦æƒ…**: å¡ç‰‡æ˜¾ç¤ºä»»åŠ¡å†…å®¹ã€æ—¶é—´ä¿¡æ¯ã€çŠ¶æ€æ ‡è¯†ç­‰å®Œæ•´ä¿¡æ¯
          - **æ—¶é—´è¿½è¸ª**: å®žæ—¶æ˜¾ç¤ºä»»åŠ¡è¿›è¡Œæ—¶é—´ã€æš‚åœæ—¶é—´ç­‰çŠ¶æ€ä¿¡æ¯
          - **æé†’æ ‡è¯†**: è¿‡æœŸä»»åŠ¡ä½¿ç”¨çº¢è‰²è­¦ç¤ºï¼Œå³å°†åˆ°æœŸä»»åŠ¡ç‰¹æ®Šæ ‡è¯†
          - **é‡å¤ä»»åŠ¡**: é‡å¤ä»»åŠ¡æ˜¾ç¤ºä¸“é—¨çš„å›¾æ ‡æ ‡è¯†
          
          ## ðŸ”„ å‡çº§è¯´æ˜Ž
          
          ### æ–°åŠŸèƒ½ä½¿ç”¨
          1. **åˆ‡æ¢çœ‹æ¿è§†å›¾**: åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­ç‚¹å‡»çœ‹æ¿è§†å›¾æŒ‰é’®
          2. **æ‹–æ‹½æ”¹å˜çŠ¶æ€**: å°†ä»»åŠ¡å¡ç‰‡æ‹–æ‹½åˆ°ç›®æ ‡çŠ¶æ€åˆ—
          3. **å¿«é€Ÿæ·»åŠ ä»»åŠ¡**: åœ¨ä»»æ„åˆ—åº•éƒ¨å¿«é€Ÿæ·»åŠ æ–°ä»»åŠ¡
          4. **ç¼–è¾‘ä»»åŠ¡**: ç‚¹å‡»ä»»åŠ¡å¡ç‰‡æˆ–ä½¿ç”¨å³é”®èœå•ç¼–è¾‘
          
          ### å…¼å®¹æ€§ä¿è¯
          - **æ•°æ®å…¼å®¹**: å®Œå…¨å…¼å®¹çŽ°æœ‰ä»»åŠ¡æ•°æ®å’Œé…ç½®
          - **åŠŸèƒ½ä¿æŒ**: æ‰€æœ‰çŽ°æœ‰åŠŸèƒ½ä¿æŒä¸å˜ï¼Œçœ‹æ¿ä½œä¸ºæ–°å¢žè§†å›¾
          - **çŠ¶æ€åŒæ­¥**: çœ‹æ¿æ“ä½œä¸Žå…¶ä»–è§†å›¾å®žæ—¶åŒæ­¥
          - **å¹³æ»‘å‡çº§**: æ— éœ€é¢å¤–é…ç½®ï¼Œå‡çº§åŽå³å¯ä½¿ç”¨
          
          ## ðŸ“‹ å®Œæ•´æ›´æ–°æ—¥å¿—
          
          æŸ¥çœ‹ [CHANGELOG.md](https://github.com/${{ github.repository }}/blob/main/CHANGELOG.md) äº†è§£è¯¦ç»†çš„æ›´æ–°å†…å®¹ã€‚
          
          ---
          
          **æ­£å¼ç‰ˆæœ¬å‘å¸ƒ**: çœ‹æ¿åŠŸèƒ½ç»è¿‡å……åˆ†æµ‹è¯•ï¼ŒçŽ°å·²ç¨³å®šå‘å¸ƒã€‚è¿™æ˜¯ MoliTodo åœ¨å¯è§†åŒ–ä»»åŠ¡ç®¡ç†æ–¹é¢çš„é‡å¤§çªç ´ã€‚
          
          æ„Ÿè°¢ä½¿ç”¨ MoliTodoï¼çœ‹æ¿è§†å›¾è®©ä»»åŠ¡ç®¡ç†å˜å¾—æ›´åŠ ç›´è§‚å’Œé«˜æ•ˆã€‚å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿Žåœ¨ GitHub ä¸Šåé¦ˆã€‚
          EOF
      - uses: softprops/action-gh-release@v2
        with:
          files: |
            dist/*.dmg
            dist/*.exe
          generate_release_notes: true
          draft: false
          prerelease: false
          body_path: RELEASE_NOTES.md